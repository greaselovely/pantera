# Pantera - PANOS Device State Exporter

Pantera is a Python utility for exporting the device state of Palo Alto Networks firewalls. It allows users to authenticate with multiple firewalls, retrieve the API keys, and export their device state in a `.tgz` format, naming the export files with the respective firewall hostname.

## Features
- Authenticates with Palo Alto Networks firewalls to retrieve API keys.
- Exports device state to `.tgz` files.
- Automatically renames export files based on the firewall hostname.
- Supports multiple firewalls by using a configuration file (`config.json`).

## Prerequisites
- Python 3.8+
- `requests` library for HTTP requests.
- `xmltodict` library for parsing XML responses.

Install dependencies using pip:
```sh
pip install -r requirements.txt
```

## Project Structure
The Pantera project follows a modular Python structure:
- `device_state.py`: Main script for exporting firewall device state.
- `config_utility.py`: Utility script to create and load the configuration file (`config.json`).
- `device_exports/`: Directory to store exported device state files.

## Usage
### Configuration Setup
1. Run the `device_state.py` script. If the configuration file (`config.json`) does not exist, it will be created.
2. You will be prompted to provide the following:
   - Whether all firewalls will use the same API key.
   - The username and password for each firewall.
   - IP addresses of the firewalls to be added to the configuration.
3. If the API key cannot be retrieved for a firewall, you can either skip that firewall or exit.

### Export Device State
To export the device state of all firewalls defined in `config.json`, simply run the `device_state.py` script:
```sh
python device_state.py
```
The script will:
1. Load the configuration.
2. Authenticate with each firewall (using the stored API keys).
3. Export the device state for each firewall and rename the file based on the firewall hostname.

Exported files are stored in the `device_exports` directory.

## Example
```
$ python device_state.py
Creating configuration file...
Will all firewalls use the same API key? (yes/no) [yes]:
Enter the username for all firewalls: admin
Enter the password for all firewalls:
Enter the IP address of the firewall (or type 'exit' to finish): 10.29.60.5
Enter the IP address of the firewall (or type 'exit' to finish): exit
Configuration saved successfully.

Exporting device state for firewall 10.29.60.5...
Device state for 10.29.60.5 exported successfully to device_exports/device_state_10.29.60.5_20241119_134612.tgz.
Exported device state renamed to device_exports/BP-FRWL-03_11192024.tgz.
```

## Configuration File (`config.json`)
The `config.json` file stores information about the firewalls including IP addresses, API keys, and the configuration version. The configuration file will be automatically generated by the utility script if it does not exist.

## Handling API Key Retrieval
If multiple firewalls share the same credentials, you can opt to use the same API key across all devices. Otherwise, each firewall will be authenticated individually to retrieve its specific API key.

## Troubleshooting
### Common Issues
- **FileNotFoundError**: Ensure that `config.json` exists by running `device_state.py` to generate the file.
- **API Key Retrieval Failure**: Check the firewall credentials and ensure that the management interface is accessible.

## License
Pantera is licensed under the MIT License. See `LICENSE` for more details.

## Contributing
Contributions are welcome! Feel free to open issues or submit pull requests to improve Pantera.

## Contact
For questions or feedback, please reach out to [greaselovely](mailto:greaselovely@example.com).